==============
WYSIWYG fields
==============

.. admonition:: Description

        WYSIWYG editor programming with Plone
        
Introduction
------------

Plone supports TinyMCE (default), but Kupu and CKEditor are also supported.

Editor preferences
---------------------

Plone supports user text changeable editor. The active editor is stored in 
the :doc:`user preferences </members/member_profile>`.

The user can fallback to hand-edited HTML by setting active editor to none.

The rich text widget can also support optional input formats besides
HTML: structured text and so on.

Text format selector
=====================

The format selector itself is rendered by ``wysiwyg_support.pt`` macros
which is Plone core

* https://svn.plone.org/svn/plone/Products.CMFPlone/trunk/Products/CMFPlone/skins/plone_wysiwyg/wysiwyg_support.pt
 
Applying styles only edit view
--------------------------------

You can use TinyMCE body selector make your CSS class have different styles in view and edit modes (inside TinyMCE)

.. code-block:: css

        
        /* Break columns in two column layout 
         * 
         * https://developer.mozilla.org/en/css3_columns
         * 
         */
        
        .column-breaker {
                column-break-before: always;
                display: block;
        }
        
        .mceContentBody .column-breaker {
                color: red;
                border: 1px dashed red;
                display: block;
        }

.. note ::

        Firefox does not actually support column breaks, so this was useful headaching experience.

Customizing TinyMCE options
----------------------------

In your add-on code, all TinyMCE options in the control panel can be exported and imported
:doc:`using GenericSetup, portal_setup and tinymce.xml </components/genericsetup>`. 

Custom field-specific style list for TinyMCE
-----------------------------------------------

Dexterity
===========

Oho.

Archetypes
===========

For Archetypes see 

* http://plone.org/products/tinymce/documentation/how-to/how-to-customize-tinymce-for-an-archetypes-richwidget

Rich text transformations
---------------------------

* http://plone.org/products/dexterity/documentation/manual/developer-manual/advanced/rich-text-markup-and-transformations

* http://pypi.python.org/pypi/plone.app.textfield

Disabling transformations
===========================

* http://stackoverflow.com/questions/5796643/make-plone-accept-any-html-input

Hacking TinyMCE Javascript
---------------------------

Plone ships with pre-compressed TinyMCE source code enabled by default.

If you want to toy around with TinyMCE source code itself, you might
want to first enable the usage of debug version of TinyMCE source.

In ``Products.TinyMCE.skins`` open tiny_mce_src.js and
copy-paste its content into tiny_mce.js.

.. note ::

        Replacing tiny_mce.js with tiny_mce_src.js in portal_javascripts
        doesn't seem to work as it breaks TinyMCE plug-in loading.

TinyMCE plug-ins
------------------

TinyMCE consists of plug-ins. Existing plug-ins can be overlaid with your 
custom version by loading Javascript after core TinyMCE load.

* Default TinyMCE plug-in Javascript files can be found under Products.TinyMCE/skins/tinymce/plugins 

* Usually TinyMCE plug-ins dialogs load in <iframe> and HTML code loads separate CSS and JS
  files from the main site

Customizing plug-in
---------------------

The recommended way is to customize TinyMCE 

* Re-register plug-in by simply including a plug-in JS code 
  in a separate Javascript file loaded after tinymce.js

* override existing individual TinyMCE files using 
  :doc:`jbot </templates_css_and_javascripts/skin_layers>`.

Overriding plug-in
===================================

Create a duplicate of plug-in JS file (table.js),
register it as a custom Javascript from your add-on resource folder.

TinyMCE overrides previous plug-in registrations with new ones
and you can just re-register your own plug-in version to override the existing version.

* Refer it in portal_javascripts

.. code-block:: xml

        <!-- TinyMCE customizations -->
        <javascript
                id="++resource++your.app/tiny_mce_special.js"
                authenticated="True"
                cacheable="True" compression="safe" cookable="True" insert-after="tinymce.js"
                enabled="True" expression=""
                inline="False" 
                />



Overriding plug-in resources
===================================                

Yoiu can also override CSS, HTML (.htm.pt templates) with ``z3c.jbot``
as instructed above.

Example::

        jbot/Products.TinyMCE.skins.tinymce.plugins.table.js.table.js
        
.. warning ::

        Since there resources are loaded in <iframe> the normal browser refresh
        does not trigger reload for them. Right click <iframe>, choose Refresh
        from context menu.        
                
Ploneboard and anonymous editor
-------------------------------

* http://www.llakomy.com/articles/enable-kupu-for-anonymous-in-ploneboard

