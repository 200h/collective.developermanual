=================
 Unit testing
=================

Unit tests are automated tests created by developer to ensure that the add-on product is
intact in the current product configuration. Unit tests are regression tests and
are designed to catch broken functionality over the code evolution.

`Plone unit testing tutorial <http://plone.org/documentation/tutorial/richdocument/unit-testing>`_.

Running unit tests
-------------------

For Plone and all registered add-ons - useful to check whether you have a good component set::

	bin/instance test

For one package::

	bin/instance test -s package.subpackage

For one test case::

	bin/instance test -s package.subpackage -t TestCaseClassName

.. warning::

	Test runner does not give an error if you supply invalid package and test case name.
	Instead it just simply doesn't execute tests.

Running add-on installers and extensions profiles for unit tests
-----------------------------------------------------------------

By default, no add-on installers or extension profiles are installed.

You need to modify PloneTestCase.setupPloneSite() call in your
base unit tests.

Simple example::

    ptc.setupPloneSite(products=['namespace.yourproduct'])

Complex example::

    ptc.setupPloneSite(products=['harvinaiset.app', 'TickingMachine'], extension_profiles=["harvinaiset.app:tests","harvinaiset.app:default"])

Setting log level in unit tests
-------------------------------

Many components use debug output level and unit testing default output level is info.
Import messages may go unnoticed during the unit test development.

Add this to your unit test code::

    def enableDebugLog(self):
        """ Enable context.plone_log() output from Python scripts """
        import sys, logging
        from Products.CMFPlone.log import logger
        logger.root.setLevel(logging.DEBUG)
        logger.root.addHandler(logging.StreamHandler(sys.stdout))


Unit testing and Zope component architecture
--------------------------------------------

Global site manager doesn't behave properly in the unit tests.

See discussion: http://n2.nabble.com/PTC-global-components-bug--tp3413057p3413057.html
