============================
 Upgrade tips
============================

.. admonition:: Description    
        
        Advanced tips for upgrading Plone.
        
Introduction
--------------

This guide contains some tips for Plone upgrades.

* `Official Plone upgrade guide <http://plone.org/documentation/manual/upgrade-guide>`_

Recommended set-up
====================

Test upgrade on local computer first.

Create two buildouts. One for old Plone version (your existing buildout)
and one for new version.

Prepare the migration in old buildout.
After all preparations are done, copy Data.fs to new buildout
and run plone_migration tool there.

Clear catalog
---------------

Before moving Data.fs to new version, clear all site portal_catalog information.

Fix persistent utilities
-------------------------        

You might need to clean up some leftovers from uninstalled 
add-ons which have not performed a clean uninstall.

Use this utility:

* http://pypi.python.org/pypi/wildcard.fixpersistentutilities 

.. note :: Perform this against old buildout

Upgrading theme
-----------------

Make sure that your site them works on Plone 4.
Official upgrade guide has tips how the theme codebase should
be upgraded. 

Theme fixing and portal_skins
------------------------------

Your theme might be messed up after upgrade.

Try playing around setting in *portal_skins* *Properties* tab.
You can enable, disable and reorder skins layer applied in the theme.

Upgrade may change the default theme and you might want to restore
custom theme in *portal_skins*.

Enabling plone.app.discussion after Plone 4.1 upgrade
-----------------------------------------------------

After migration from an earlier version of Plone, you will may notice that you
do not have a *Discussion* control panel for ``plone.app.discussion``, the new
commenting infrastructure which now ships as part of new Plone installs beyond
version 4.1.  If a check of your *Site Setup* page reveals that you do not have
the *Discussion* control panel, implement the following.

Install plone.app.discussion manually
=====================================

#. Log into your Plone site as a user with Manager access
#. Browse to the following URL to manually install ``plone.app.discussion``::

    http://<your-plone-url>:<port>/<plone-instance>/portal_setup/manage_importSteps

#. In the *Select Profile or Snapshot* drop-down menu, select 
   ``Plone Discussions``.
#. Click the ``Import all steps`` button at the bottom of the page.
#. Confirm that *Discussion* is now present as a control panel in your 
   *Site Setup*

Migrate existing comments
=========================

Follow the instructions regarding `How to migrate comments to
plone.app.discussion
<http://plone.org/products/plone.app.discussion/documentation/how-to/how-to-migrate-comments-to-plone.app.discussion>`_
to migrate existing Plone comments.

