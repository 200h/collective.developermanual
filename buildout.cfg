#
# Buildout to create toplone command which uploads Sphinx documentation to Plone site
#
[buildout]
parts = sphinx zope2  instance  test toplone 
extends =
  	http://dist.plone.org/release/3.2/versions.cfg

versions = versions

extensions =
  mr.developer
  buildout.dumppickedversions
dump-picked-versions-file = picked.cfg
sources = sources
sources-dir = ${buildout:directory}/src
auto-checkout =
allow-picked-versions = true
# Set transmogrify package repository pointer here to allow easy switching between private and public repos
# Final repo URLs are format git://github.com/djay/transmogrify.htmltesting.git
[transmogrify]
git-repo = git://github.com/djay

[sources]
#transmogrify.webcrawler = git ${transmogrify:git-repo}/transmogrify.webcrawler.git
transmogrify.webcrawler = git git@github.com:miohtama/transmogrify.webcrawler.git

transmogrify.pathsorter = git ${transmogrify:git-repo}/transmogrify.pathsorter.git
transmogrify.htmltesting = git ${transmogrify:git-repo}/transmogrify.htmltesting.git
transmogrify.siteanalyser = git ${transmogrify:git-repo}/transmogrify.siteanalyser.git

# Following have been patched

#transmogrify.ploneremote = git ${transmogrify:git-repo}/transmogrify.ploneremote.git
transmogrify.ploneremote = git git://github.com/miohtama/transmogrify.ploneremote.git

#transmogrify.htmlcontentextractor = git ${transmogrify:git-repo}/transmogrify.htmlcontentextractor.git
transmogrify.htmlcontentextractor = git git://github.com/miohtama/transmogrify.htmlcontentextractor.git


[sphinx]
recipe = collective.recipe.sphinxbuilder
#doc-directory = .
outputs = html
source = ${buildout:directory}/source
build = ${buildout:directory}/build
eggs =
  Sphinx==0.6.4
  Docutils
  roman
  Pygments


#
# Recipe to create toplone command.
# 
# It will walk through all blueprints defined
# in pipeline.cfg and override their target parameter
# to be a remote Plone site given on the command line.
# This all happeins in initialization= magic.
#
# Also Python logger is initialized to give us verbose
# output. Some blueprints use logging module for the output.
#
[toplone]
recipe = zc.recipe.egg
eggs =
  transmogrify.htmltesting
  transmogrify.webcrawler
  transmogrify.siteanalyser
  transmogrify.htmlcontentextractor
  transmogrify.pathsorter
  transmogrify.ploneremote
  Products.CMFCore
  
# This initialization script sets remote site argument
# for remote blueprints defined in pipeline.cfg
initialization =
  from urllib import pathname2url as url
  from sys import argv
  import logging
  
  logging.basicConfig(level=logging.DEBUG)
  args = dict(webcrawler=dict(site_url=url('build/html')),
      localconstructor=dict(output=url('ploneout')),
      ploneuploader=dict(target=argv[1]),
      schemaupdater=dict(target=argv[1]),
      publish=dict(target=argv[1]),
      excludefromnavigation=dict(target=argv[1])
      )
arguments = 'pipeline.cfg', args
entry-points = toplone=transmogrify.htmltesting.runner:runner
extra-paths = ${zope2:location}/lib/python

[test]
recipe = zc.recipe.testrunner
eggs =
  ${toplone:eggs}
  transmogrify.htmltesting
extra-paths = ${zope2:location}/lib/python

[lxml]
recipe = z3c.recipe.staticlxml
egg = lxml == 2.2.2

[zope2]
recipe = plone.recipe.zope2install
url = ${versions:zope2-url}
fake-zope-eggs = true
additional-fake-eggs =
    ZConfig
    pytz
    zope.site


[instance]
recipe = plone.recipe.zope2instance
zope2-location = ${zope2:location}
debug-mode = on
verbose-security = on
user = admin:admin
zcml-eggs =
#	pretaweb.funnelweb
#    plone.reload
eggs =
    PIL
    Plone
    plone.i18n
    ${instance:zcml-eggs}
    ${lxml:egg}
zcml =
	${instance:zcml-eggs}

[roadrunner]
recipe = roadrunner:plone
zope2-instance = instance
packages-under-test =
    pretaweb.funnelweb==0.2

[omelette]
recipe = collective.recipe.omelette
eggs = ${instance:eggs}

[versions]
BeautifulSoup = 3.1.0.1
Jinja2 = 2.5.2
PIL = 1.1.7
Pygments = 1.3.1
Sphinx = 0.6.4
argparse = 1.1
buildout.dumppickedversions = 0.4
collective.recipe.sphinxbuilder = 0.6.3.3
collective.transmogrifier = 1.2
distribute = 0.6.14
docutils = 0.7
Docutils = 0.7
elementtree = 1.2.7-20070827-preview
lxml = 2.2.2
mr.developer = 1.15
plone.reload = 1.0
python-openid = 2.2.5
roadrunner = 0.2.3.1
roman = 1.4.0
transmogrify.htmlcontentextractor = 1.0dev
transmogrify.htmltesting = 0.2dev
transmogrify.ploneremote = 1.0a1dev
transmogrify.siteanalyser = 1.0a1dev
z3c.autoinclude = 0.3.3
z3c.form = 1.9.0
z3c.recipe.staticlxml = 0.7.2
zc.buildout = 1.4.3
zc.recipe.cmmi = 1.3.2
zc.recipe.egg = 1.2.0
#zc.recipe.testrunner = 1.4.0 depends on too new z3c.recipe.scripts and zc.buildout
zc.recipe.testrunner = 1.3.0
zope.exceptions = 3.6.1
zope.interface = 3.6.1
zope.testrunner = 4.0.0b5
